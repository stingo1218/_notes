# **第一章**  **概述**

### 什么是接口电路？

  连接部件  I/O电路  数据  交换数据的桥梁

  为什么要交换数据？

  交换数据给谁呢？

 数据处理   数据交换的核心—CPU

### 设置接口的目的

 （1）通过接口实现设备和总线的连接

 （2）连接后，CPU通过接口对设备进行访问

### 为什么要在本地总线和I/O设备之间设置接口？

1） CPU与外设二者的信号不兼容，包括信号线的功能定义、逻辑定义和时序关系；

2） CPU与外设的速度不匹配，CPU的速度快，外设的速度慢；

3） 若不通过接口，而由CPU直接对外设的操作实施控制，会使CPU处于穷于应付与外设打交道之中，大大降低CPU的效率；

4） 若外设直接由CPU控制，会使外设的硬件结构依赖于CPU，对外设本身的发展不利。

### 接口在微机系统中的作用

在微机系统中,接口处于微机总线与设备之间，进行CPU与设备之间的信息交换

它在CPU与设备之间的桥梁与转换作用

### 接口技术的基本任务

设置接口的目的有两条:通过接口实现设备与总线的连接;连接起来以后,CPU通过接口
对设备进行访问，即操作或控制设备。

### 现代微机总线结构

现代微机是多总线,有三级总线,即Host总线、PCI总线.ISA总线。

### I/O设备接口的功能

1. 执行CPU命令
2. 返回外设状态
3. 数据缓冲
4. 信号替换
5. 设备选择
6. 数据宽度与数据格式转换

### I/O设备接口的组成

一个能够实际运行的I/O设备接口，由硬件和软件两部分组成。

### I/O设备接口与CPU交换数据的方式

1/O设备接口与CPU之间的数据交换,一般有

- 查询
- 中断
- DMA

三种

# **第二章	 总线**

### 微机系统的组成

从硬件的角度来说,任何一个基于微处理器的微机系统都是由微处理器、存储器和I/O系统3个部分通过总线互相连接而成的,如图2.1所示。

![image-20220526213230240](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526213230.png)

### 总线的基本组成

总线主要由数据总线、地址总线、控制总线、电源和地线这4部分组成。

**数据总线**：为双向三态逻辑，用来传输数据，8位->64位；它的宽度决定着计算机系统的处理能力强弱。

**地址总线**：为单向三态逻辑，用来传输地址信息，16位->64位；它的根数决定着计算机系统的寻址范围的大小。

**控制总线**：有单向、双向三态逻辑或非三态逻辑，用来传送控制或状态信息，表现计算机控制能力的强弱。

**电源和地线**：电源电压的高低；反映着计算机系统能耗的高低。

### 总线的性能参数

(1)总线频率
即总线的工作频率,以MHz表示,它是反映总线工作速率的重要参数。每秒传输数据的次数.
(2)总线宽度
即数据总线的位数,用bit(位)表示,如8位、16位.32位和64位总线宽度。
(3)总线传输率
即单位时间内总线上可传输的数据总量(最多的字节数),用每秒最大传输数据量,单位用MB/s表示。
**总线传输率=(总线宽度/8位)X总线频率**   ==宽度越高,频率越快,传输率越高==
例如,若PCI总线的工作频率为33 MHz,总线宽度为32位,则总线传输率为132 MB/s.

(7)信号线数.
信号线数表明总线拥有多少信号线,是数据、地址、控制线及电源线的总和,信号线数与性
能不成正比,但与复杂度成正比。

### 总线的层次化结构

现代微机系统中,采用多总线的层次化结构。层次化总线结构主要有3个层次:CPU总线、PCI总线、本地总线(ISA总线)

### 总线桥

连接CPU总线与PCI总线的桥,称为北桥;连接PCI总线与本地总线(如ISA总线)的桥,称为南桥。

#### 接口分层的原因

其次,桥的产生，是接口分层次的直接原因。

桥与接口最大的区别是传递信息的方法不同。

- 桥是间接传递信息，接口是直接传递信息

# **第三章	 译码技术**

### 不可缺少

设备选择功能是接口电路应具备的基本功能之一,因此,作为进行设备端口选择的I/O端口地址译码电路是每个接口电路中不可缺少的部分。译码技术作用:<u>确定端口地址</u>

### I/O端口地址空间范围

无论是早期PC微机还是现代微机的I/O地址线都只有16位，因此I/O端口地址空间范围为0000H~FFFFH连续64 KB地址

### 什么是端口

端口(Port)是接口(Interface)电路中能被CPU访问的寄存器的地址。

### I/O端口地址编址方式

1. 独立编址
2. 统一编址

### I/O地址译码的方法

1.	全译码
2.	部分译码
3.	开关式译码

### 固定式单个端口地址译码电路的设计

![image-20220526224410301](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526224410.png)

![image-20220526224430215](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526224430.png)







**I/O操作：**通常所说的I/O操作是指对I/O端口的操作，而不是对I/O设备的操作，也就是说CPU所访问的是与I/O设备相关的端口，而不是I/O设备本身。

**端口编址方法：**

1、端口地址与存储器地址统一编址

2、端口地址单独编址

**I/O指令与I/O读/写控制信号的关系：**

  它们是完成1/0操作这一共同任务的软件和硬件，是相互依存、缺一不可的两个方面。

- IOR和IOW是CPU对I/O设备进行读/写的硬件上的控制信号，低电平有效。
- 执行IN指令使IOR信号有效，完成读(输入)操作。
- 执行OUT指令使IOW信号有效，完成写(输出)操作。

**PC微机的I/O端口地址译码方式：**

- **全译码**
  - 所有I/O地址线(A0-A9)全部作为译码电路的输入参数译码，一般在要求产生单个端口时采用。
- **部分译码**
  - 只有高位地址线参加译码，产生片选信号CS（低电平有效），而低位地址线不参加译码，一般在要求产生多个端口的接口芯片中采用。
- **开关式译码**
  - 在部分译码方法的基础上,加上地址开关来改变端口地址。一般在要求I/O端口地址需要改变时采用。

**固定式单个端口地址译码电路的设计:**

> 例题：某接口的I/O端口地址为2F8H，在非DMA期间只读，为该接口设计译码电路。
>
> AEN=0时：不是DMA操作时，译码才有效；
>
> AEN=1时：为DMA操作，译码无效。
>
> ![image-20220526163551087](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526163551.png)
>
> 
>
> ![image-20220526163603707](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526163603.png)
>
> 能执行读写操作的2E2H端口地址的译码电路。
>
> ![image-20220526185604142](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526185604.png)
>
> ![image-20220526185609051](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526185609.png)

# **第四章	 存储器**

### 存储系统的主要性能指标：

- **存储容量**：存储器所能存储的二进制数码的数量
  - 以位/字节为单位
  - 存储容量=存储单元数×存储单元字长
- **存取速度**：用来描述主存储器速度的指标主要有存取时间、存储周期和带宽。
  - *存取时间*：是指从启动一次存储器访问，到完成该访问为止所经历的时间。
  - *存取周期*：是指对存储器进行两次独立访问所需最小时间间隔
  - *存取带宽*：是指在单位时间内存取信息的总量（bit/s或B/s）

- **功耗**：功耗通常是指每个存储元消耗功率的大小。
  - 单位为微瓦/位（µW/位）或者毫瓦/位（mW/位）。
  - 功耗越小越好。
- **可靠性**:一般是指对电磁场及温度变化等的抗干扰能力，
  - 一般平均无故障时间为数千小时以上。
  - 平均故障间隔越大，存储器的可靠性越高。

### 存储器分类

![image-20220526185848704](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526185848.png)

#### RAM的分类 ：

- **SRAM(静态RAM)**：存储单元电路以双稳为基础,故状态稳定,只要不掉电，信息不会丢失。价格较贵，用于高速缓存。
- **DRAM(动态RAM)**：存储单元电路简单，集成度高，功耗小，但即使不掉电也会因电容放电而丢失信息，所以需定时刷新。
- **NVRAM(非易失性RAM)**：多数是由SRAM和电池共同构成。正常时为SRAM;掉电或电源故障时，立即由电池供电，使不丢失。多用于存储系统中的重要信息保存和掉电保护。

#### ROM的分类 ：

- **掩模ROM**：由厂商按用户要求掩模制作，封装后不能改写，用于数据不再改变且使用量大的场合。
- **PROM(可编程)**:可由用户一次性编程写入，写入后不能改写。
- **EPROM(紫外线可擦PROM)**： 用户可多次改写内容，改写方法一般可 选用紫外线擦除，再编程写入，有任一位错，都须全片擦除、改写。紫外线照射约半小时，所有存储位复原到1 。
- **E2PROM (电可擦PROM)**： 可以字节为单位多次用电擦除和改写，并可直接在机内进行，无需专用设备，故方便灵活。
- **FLASH(闪存)**: 它与E2PROM类似，也是一种电擦写型ROM。
  - 与E2PROM 的主要区别是： EEPROM是按字节擦写，速度慢，而闪存是按块擦写，速度快。

### 高速缓冲存储器工作原理

![image-20220526234344085](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526234344.png)

### 高速缓冲存储器地址映射 

![image-20220526234601943](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526234602.png)

# **第五章	 DMA技术**

### 主要用于

DMA传输主要用于需要高速、大批量数据传输的系统中，以提高数据的吞吐量

### DMA的用途及特点

**DMA数据交换**：存储器与外设、存储器与存储器、外设与外设之间直接交换数据，不经过CPU的累加器中转，在传送过程中，不需CPU控制，由DMA控制器负责对DMA传送的全过程控制。

釆用DMA传输方式是让存储器与I/O设备(磁盘)，或I/O设备与I/O设备之间直接交换数据

**DMA的用途**：高速、大批量数据交换，提高数据吞吐量。

如磁盘存取、图像处理、高速数据采集、同步通信中的数据收发等。

### 软启动和硬启动

- I/O设备从外部发DREQ提出请求， 称为硬件请求（**硬启动**）
- 用程序从内部对请求寄存器写命令提出请求，称为软件请求 （**软启动**）

### DMA 操作类型

**主要**进行数据传输操作，**但也进行**数据校验和检索等操作。

（1）**数据传送**：把数据从源地址送到目的地址。DMA传输的读/写操作是针对存储器来说的，DMA读是从存储器读取，DMA写是向存储器写。

（2）**数据校验**：对数据块中的每个字节进行某种校验。DMA通道用于校验操作时，DMA控制器不发送存储器或I/O设备的读写控制信号。数据校验操作一般安排在读数据块之后。主要进行数据传输操作，但也进行数据校验和检索等操作。

（3）**数据检索**：在指定的数据块中查找关键字节，如果存在，就停止检索，并在状态字中标记或申请中断。（待查找字节或数据写入比较寄存器，在指定的存储区域内从起始单元开始逐一比较）

### DMA操作方式

指进行上述某种DMA操作类型时，每次DMA操作所操作的字节数。

（1）**单字节方式**：一次DMA操作只传送一个字节。

发出一次总线请求，DMA控制器占用总线后，进入DMA周期只操作一个字节数据便释放总线。如若要传输下一字节，必须重新发出申请。

结束条件是：一个字节传送（或校验或检索）完毕。

（2）**连续（块字节）方式**：一次DMA操作针对一批数据。

启动一次可把整个数据块传送完。只要DMA传输开始，DMA控制器就始终占用总线。即使在传输过程中DMA请求变得无效，DMA控制器也不释放总线。这种方式速度快，但可能会产生冲突。只有当前字节计数器减到0，产生EOP信号，才释放总线。

结束条件是：数据送完或校验完毕或检索到“匹配字节”。

（3）**请求（询问）方式**：一次DMA操作针对一批数据。==效率最高==

这种方式以外部是否有DMA请求来决定，有请求时，DMA控制器才占用总线，当DMA请求无效时，DMA控制器就会释放总线，把总线控制权交给CPU。

结束条件是：DMA请求是无效，或数据送完，或校验完毕，或检索到“匹配字节”，或由外部送来结束信号。

(4)**级联方式**

### DMAC的两种工作状态

DMA控制器是作为系统的主控者，在它的控制下，能够实现两种存储实体之间的直接高速数据传输。因此，它具有接管和控制微机系统总线的功能。但在它取得总线控制权之前，又与其他I/O接口芯片一样，接受CPU的控制。 

**主动态**：主控器，DMAC代替CPU获得总线的控制权，成为系统总线的主控者，向存储器和外设发号施令。

**被动态**：受控器，DMAC接受CPU对它的控制，成为系统CPU的受控者。

### 8237简介

82C37A控制器有4个独立的通道，每个通道均有64K寻址与计数能力，并且还可以用级联方式来扩充更多的通道。它允许在外设与存储器，以及存储器与存储器之间直接传输数据。

### 8237引脚

8237外部引脚见教材P93图6.2

![image-20220526190731485](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526190731.png)

- A0~A3:4个低位地址线，双向三态。被动态下为输入，作为内部寄存器与计数器端口寻址，可产生16个端口；主动态下为输出，作为存储器地址的最低4位。
- A4~A7:4个地址线，输出。仅用于主态，作为存储器地址的一部分。

- DB0~ DB7:数据与地址复用线，双向三态。被动态下作数据线用，传送CPU的命令或返回状态；主动态下作地址线用，成为访问存储器的高8位地址线。在存储器到存储器的DMA传输方式时，DB0~DB7还作为数据的输入/输出端。

### 8237内部寄存器组

#### （1）基地址寄存器（16位）DMA传送的RAM首地址。

#### （2）当前地址寄存器（16位）传送过程中RAM地址。

为了设置DMA传送的起始地址，每个通道都有两个地址寄存器—基地址寄存器和当前地址寄存器，两者的I/O端口地址相同。

**基地址寄存器存放DMA传输的起始地址，只能写不能读；**

**当前地址寄存器保存将被访问的下一个存储单元地址，可读可写**

在初始化时，由CPU以相同的地址值写入基地址寄存器和当前地址寄存器。

传输过程中，**基地址寄存器的内容保持不变**。**当前地址寄存器的内容在传输过程中是变化的**，**在每次传输后地址自动增1(或减1)**，直到传送结束。

#### （3）基字节计数器（16位）DMA传送的总字节数。

#### （4）当前字节计数器（16位）DMA传送过程中没有传送完的字节数。

为了设置DMA传送的字节数，每个DMA通道有两个字节计数寄存器——基字节计数寄存器和当前字节计数寄存器，两者的I/O端口地址相同。

**基字节计数寄存器存放DMA传输的总字节数，只能写不能读；**

**当前字节计数寄存器存放DMA传输过程中没有传输完的字节数，可读可写。**

在初始化时，由CPU以相同的字节数写入基字节计数寄存器和当前字节计数寄存器。

在传输过程中，**基字节计数寄存器内容保持不变**。**当前字节计数寄存器内容是变化的**，**在每次传输之后，字节数减1**，当它的值减为0时，便产生EOP，表示字节数传输完毕。

==在写基字节计数寄存器时应注意==:82C37A执行当前字节计数寄存器减1是从0开始的，所以,若要传输N字节,则写基字节计数寄存器的字节总数应为N-1。

### DMA系统构成/DMA由哪些

由两片DMA控制器、DMA页面地址寄存器，以及总线裁决逻辑构成一个完整的DMA 系统。

### DMA通道

PC微机中,DMA控制器82C37A的通道0用于DRAM刷新，通道1由系统保留，通道2用于硬盘，通道3用于软盘。因此，用户可用的DMA通道是通道1。

# **第六章	 定时与计数技术**

### 定时与计数

定时与计数在本质上是一样的，且都是计数

### 8253/8254基本功能

- 有3个独立的16位计数器通道；
- 每个计数器有2种计数方式可以按二进制或BCD二-十进制计数；
- 每个计数器有6种工作方式，产生6种不同的输出OUT信号；
- 输入、输出电平与TTL兼容。
- 82C54A的4个端口地址为304H(计数器O）、305H（计数器1）、 306H（计数器2）、307H（命令寄存器）。如果没给就用这个

### 8253/8254定时计数器

每个计数器由：

一个16位计数初值寄存器（CR, Counter Register），

一个16位的减1计数器（CE，Counter Element），

一个16位输出锁存器组成（OL，Output Latch）。

锁存器在CPU读取过程中，锁存计数值。

**无法直接读取当前计数值,要放到当前计数值锁存器中再读取**

![image-20220526191125749](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191125.png)

### 8253的工作方式

1）方式0：计数结束中断（软启动/自动停止）
2）方式1：单脉冲发生器（硬启动/自动停止）
3）方式2：频率发生器（软启动/不能自动停止）自动赋初值
4）方式3：方波发生器（软启动/不能自动停止）自动赋初值
5）方式4：软件触发方式（软启动/自动停止）
6）方式5：硬件触发方式（硬启动/自动停止）

1. 0方式功能
   0方式作事件计数器，计数器的大小就是计数初值。其特点是，计数结束,输出端OUT产生0->1的上升沿，利用OUT信号由底变高，可申请中断。改变计数初值就可以改变计数器 的大小，由“软件”启动。计数结束，自动停止，不需外加停止信号O
2. 1方式功能
   1方式作可编程单稳态触发器，单稳延迟时间=计数初值X时钟脉宽。其特点是，延时期 间输出的是低电平，低电平的宽度可以由程序控制，即改变计数初值就可以改变延时时间。由 “硬件”启动。计数结束，自动停止，不需外加停止信号。
3. 2方式功能
   2方式作分频器，分频系数就是计数初值。其特点是，产生重复连续的负脉冲，负脉冲宽 度等于时钟脉冲的周期。改变计数初值就可以改变输出负脉冲波形的频率。由“软件"启动。 计数结束，不能自动停止，需外加停止信号。
4. 3方式功能
   3方式作方波发生器。其特点是,产生占空比为1 ： 1或接近1 ： 1的重复连续方波，方波 的周期等于“计数初值X时钟脉宽”的周期。改变计数初值就可以改变输出方波的频率。由 “软件”启动。计数结束，不能自动停止，需外加停止信号。
5. 4方式功能
   4方式作单个负脉冲发生器。其特点是，产生单个选通脉冲，脉冲宽度等于时钟脉冲的周 期。改变计数初值就可以改变选通脉冲产生的时间。由“软件”启动。计数结束，自动停止，不 需外加停止信号。
6. 5方式功能
   5方式作单个负脉冲发生器。其特点是，产生单个选通脉冲，选通脉冲宽度等于时钟脉冲 的周期。改变计数初值就可以改变选通脉冲产生的时间。由“硬件"启动。计数结束，自动停 止，不需外加停止信号。

主要区别： 

1. 输出波形不同
2. 启动计数器的触发方式不同
3. 计数过程中GATE对计数操作的影响不同

> 设8253的端口地址为：F8H～FBH，若用计数器0工作在方式1，按二―十进制计数，计数初值为5080H，进行初始化编程。
>
> ```apl
> 答：命令字（控制字）为：00110011B=33H
> 	   初始化程序：
>            MOV 	AL，	  33H	；控制字
>            OUT 	0FBH，AL	；写入控制字寄存器端口地址
>            MOV 	AL，    80H	；
>            OUT 	0F8H，AL	；低8位写入计数器0
>            MOV 	AL，    50H	；
>            OUT 	0F8H，AL 	；高8位写入计数器0
> ```

### 计数初值的范围

由于计数初值寄存器和减法计数器是16位的，故计数初值的范围对应二进制数的范围为 OOOOH-FFFFH；对应十进制数（BCD）为0000〜9999。其中,0000为最大值，因为82C54A的计数是先减1后判断，所以，0000代表的是二进制数中的216（65536）和十进制数中的 104（10000）



### 六种方式输出波形

#### 0方式的输出波形

![image-20220526191400896](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191400.png)

#### 方式1：单脉冲发生器

写入控制字后，OUT变高，然后写入计数初值。当GATE信号出现上升沿后，开始计数，OUT变低，计数到0时，OUT变高。当再来一个GATE上升沿后，计数器重新开始计数，OUT再次变低。

![image-20220526191430058](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191430.png)

#### 方式2:频率发生器

![image-20220527002446449](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527002446.png)

#### 方式3：方波发生器

写入控制字后，输出OUT变高，写入计数初值后开始计数，当计数到一半计数值时，输出变低，计数到0时，输出变高，周而复始地工作。

![image-20220526191446954](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191447.png)

![image-20220526191512431](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191512.png)

#### 方式4：软件触发方式

写入控制字后，OUT变高，写入计数初值后开始计数，当计数到0后，OUT变低，经过一个CLK脉冲后，OUT变高。

![image-20220526191529466](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191529.png)

#### 方式5：硬件触发方式

写入控制字后，OUT变高，然后写入计数值。由GATE的上升沿启动计数，当计数到0时，OUT变低，经过一个CLK之后，OUT恢复为高。

![image-20220526191546703](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191546.png)

# **第七章  中断技术**

常用的CPU与接口数据交换方式：查询方式、中断方式和DMA方式。

中断是指CPU在正常运行程序时，由于外部/内部随机事件或由程序预先安排的事件，引起CPU暂时停止正在运行的程序，而转到为外部/内部事件或为预先安排的事件服务的程序中去，待服务程序处理完毕，再返回去继续执行被暂时停止的程序。

#### 可屏蔽硬件中断（INTR）：

这是由**外部设备**通过中断控制器用中断请求线INTR向微处理器申请而产生的中断, 由INTR引脚引入，它受中断允许标志的影响，当外部提出申请时, 只有当IF＝1(开中断)时，可屏蔽中断才能进入，

#### 内部中断：

①溢出中断: INTO指令，条件: OF=1

②除法出错中断:在执行除法指令时，若除数为0或商大于目的寄存器所能表达的范围，就产生一个向量号为0的内部中断。

③单步中断:单步中断标志TF为1时，在每条指令执行结束后产生一个向量号为1的内部中断。单步中断为系统提供了一种方便的调试手段，能够逐条地执行指令。

④断点中断: INT 3指令中断，执行一个INT 3指令，产生一个向量号为3的内部中断。断点中断常用于设置断点，停止正常程序的执行，转去执行某种类型的特殊处理，用于调试程序。

⑤指令中断:中断指令INT n。

### 中断优先级排序

多个中断请求同时发生，响应顺序按优先级排列。优先级排列如下(高->低)

1、内部中断和异常	

2、软件中断 INT n	

3、断点中断

4、溢出中断

5、外部不可屏蔽中断NMI

6、外部可屏蔽中断INTR		

7、单步中断

![image-20220526191856897](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191857.png)

**注意：高级中断可以打断低级中断，反之则不然。**

### 中断处理过程

通常包括：**中断申请、（中断判优）、中断响应、中断处理、中断返回**。

中断响应:什么时候响应?

**CPU会在结束当前所执行的指令后，立即响应中断请求。**

**保护现场:** 当前正在执行的程序段地址(CS) 和偏移地址(IP)以及标志寄存器(FR) 压入堆栈。

![image-20220526191935058](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191935.png)

![image-20220526191944092](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526191944.png)

### 中断向量及中断向量表

段基址CS（2个字节）和偏移地址IP（2个字节）

- 中断类型号：每个中断的编号，0-255，共256个中断。
- 中断向量：中断服务子程序的入口地址
- 中断向量表：存放中断服务程序入口地址的存储空间
  -  中断向量表中是将中断向量按一定的规律排列成一个表，当中断源发出中断请求时，即刻查找该表，找出中断向量，然后转入相应的中断服务程序。
- 中断向量地址:
  - 中断向量在表中的位置称为中断向量地
  -  中断向量地址=中断类型号X4

### 中断向量表的表地址与中断类型的关系

![image-20220526192047989](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192048.png)

> 例1：中断向量“21H”：存放在84H ～ 87H单元中，08H型中断向量存放在何处？
>
> 解： 08H× 4=0000100000=20H
>    08H型中断向量存于 20H ～ 23H单元中
>
> 例2：有8个中断源，其中断类型码为08H～0FH，在RAM的0000:002CH单元中依次存放20H、FFH、20H和E0H 。问该中断源对应的中断类型码是多少？中断服务子程序的入口地址又是多少? 
>
> ![image-20220526192127146](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192127.png)

### 8259的工作方式

![image-20220527004601152](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527004601.png)

### 82C59A的内部结构——读写控制逻辑

接收CPU送来的读/写控制信号、片选信号以及地址选择信号，对内部各个寄存器进行读写操作。

RD/WR：读写控制信号（输入）

A0：地址信号（输入），用来选择芯片内部的端口。

CS：片选信号（输入），低电平有效，8259才被选中。**单片连接时，不起作用**

![image-20220526192157648](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192157.png)

### 82C59A的内部结构——级联缓冲/比较器

级联缓冲/比较器在级联方式的主从结构中(两个以上的8259A组成的系统)，用来存放和比较系统中各8259A的从设备标志(ID)。

CAS0-CAS2:级联时用于主从8259的连接

SP/EN:主从定义/缓冲器工作信号。单片连接时SP=1;多片级联时，主片SP=1，从片SP=0。

​	主片的3条级联线与各从片的同名级联线引脚相接，主片为输出，从片为输入。

![image-20220526192231780](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192231.png)

### 82C59A的内部结构——控制逻辑

控制逻辑是控制8259A内部各个部件的主要逻辑电路。主要功能包括:

(1)根据CPU对8259A编程设定的工作方式产生内部控制信号

(2)如果中断请求寄存器IRR有未被屏蔽的位，则控制逻辑对应于当时最高优先级的中断源，**向CPU发中断请求信号INT。**

(3)接收CPU送来的中断响应信号INTA，并置位中断服务寄存器ISR的相应位(ISRi)。

(4)控制发出相应的中断类型号，以供CPU读取。

![image-20220526192302543](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192302.png)

### 82C59A的性能

- 有8级中断优先控制，可级联扩展至64级；
- 每一级中断都可置为允许或屏蔽状态；
-  工作方式可通过编程设置。

### 初始化命令格式

![image-20220527012615838](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527012615.png)

# 第八章	 并行接口技术

### 8255A的引脚

地址线CS片选信号,低电平有效;A1、A0芯片内部端口地址寻址,可形成4个端口地址。(A0A1:00 01 10 11)

00:A 

01:B

10:C

11:控制寄存器

- PAo~PA7,A端口的输人/输出线。
- PB0~PB7,B端口的输人/输出线。
- PC0~PC7,C端口的输人/输出线。

### C端口用途

**作按位控制用时**:C端口的8个引脚可以单独从1个引脚输出高/低电平。此时,C端口是作按位控制用,而不是数据输出用的。

### 8255A内部

其中,3个8位输人/输出端口(PA PB PC),提供给用户连接I/O设备使用。每个端口包含一个数据输人寄存器和一个数据输出寄存器。**输人时端口有三态缓冲器的功能,输出时端口有数据锁存器功能**

### 8255A端口地址分配

系统分配:

4个地址的分配是:PA端口为60H.PB端口为61H,PC端口为62H,命令与状态口为63H。

用户拓展后:

4个端口地址是：PA端口为300H,PB端口为301H, PC端口为302H,命 令与状态端口为303H。

### 8255A基本操作与端口地址

![image-20220526192351914](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192352.png)

系统分配给8255的4个端口地址是：

PA端口为60H,PB端口为61H,PC端口为62H,命令与状态口为63H.

用户扩展的8255的4个端口地址是：

PA端口为300H,PB端口为301H,PC端口为302H,命令与状态口为303H.

### 8255的工作方式

![image-20220526192427617](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526192427.png)

#### 方式0：基本输入/输出方式。

1）方式0是一种简单的输入/输出方式，对应的数据传输控制方式为程序方式。

2）A口、C口高4位、B口、C口低4位均可分别定义为输入或输出，各端口相互独立，共有16种不同的组合。

3）定义为输出的口均有锁存数据的能力，而定义为输入的口则无锁存能力

4）在方式0下，C口有按位进行置位和复位的能力。

5）当选用8255A方式0作为无条件传输的接口电路时，由CPU用简单的I/O指令对三个端口进行读/写操作。

6）当选用8255A方式0作为查询式接口电路时，可用A，B，C三个口的任一（或多）位充当查询信号即状态位（但通常都是选用C口承担），其余I/O口仍可作为独立的端口和外设相连，同样由CPU用简单的I/O指令来进行读/写。

#### 方式0的特点：

- 一次初始化只能把某个并行端口置成输入或输出，即单向输入/输出，不能一次初始化给置成既输入又输出；
- 不要求固定的联络（应答）信号，无固定的工作时序和固定的工作状态字；
- 适用于无条件或查询方式与CPU交换数据，不能采用中断方式交换数据。

#### 方式1：选通输入/输出工作方式。

1）三个端口分为两组，即A组和B组。

2）A组包括8位数据端口A和3位PC控制/状态端口（PC3、4、5），B组包括8位数据端口B和3位PC控制/状态端口（PC0、1、2）， 其中，两个3位PC端口分别作为A口和B口的应答联络信号。

3）每一个8位数据端口均可设置为独立的输入/输出方式，可单独连接外设，通过编程分别设置它们为输入或输出，且两种工作方式均可锁存。

4）控制/状态口除了指示两组数据口的状态及选通信号外，其余2位，仍可工作在方式0，通过编程设置为输入或输出

四种组态：A端口方式1输入、 A端口方式1输出；B端口方式1输入、 B端口方式1输出。

![image-20220526195041848](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526195041.png)

##### （1）方式1的输入组态和应答信号的功能

- STB非：外设给82C55A的“输人选通”信号,低电平有效,表示外设开始送数。外设送入的选通信号 ，用于将外设输入的数据打入8255A的输入缓冲器，相当于8255A的启动信号。

- IBF：82C55A给外设的回答信号“输人缓冲器满”,高电平有效,表示暂不能送新数据。输入缓冲器满，作为STB的回答信号，由8255发往外设。高有效，表示8255收到数据，但未被CPU取走通知外设不可再送数据；当其为低时，表示CPU已取走数据，允许外设送新的数据。

<u>握手信号的存在避免了数据的丢失（避免后面的数据将前面的数据覆盖）</u>

- INTR：82C55A给CPU的“中断请求”信号,高电平有效,请求CPU从82C55A读取数据. 中断请求信号，请求CPU中断，INTR置位的3个条件是：

     STB为高即数据已经打入8255

     IBF为高即8255已经收到数据

     INTE为高即8255允许以中断方式应答

- lNTE：中断允许信号，设置中断允许或屏蔽中断的信号。INTE没有外部引出端，由软件对C口某位进行置0或置1的操作实现。置1允许中断，置0屏蔽中断。

   对A口来讲，是由PC4置位来实现，

   对B口来讲，是由PC2置位来实现。 

##### （2）方式1的输出组态和应答信号功能

- OBF非：82C55A给1/O设备的“输出缓冲器满”信号,低电平有效,通知外设来取数。输出锁存器满。当CPU将要输出的数据送入8255时有效，将数据连带这个信号一起送往外设，相当于启动信号，用来通知外设可以开始从8255接收数据。

- ACK非：I/O设备给82C55A的“回答”信号,低电平有效,表示外设已经从82C55A的端口接收到了数据。外设应答/响应信号。由外设送入8255，持续一段时间后由外设撤销。有效时，表示外设已将数据从8255A的输出锁存器中取走，这个信号可以将OBF变高。

- INTR：82C55A给CPU的“中断请求”信号,高电平有效,请求CPU向82C55A写数据. 中断请求信号。INTR置位的3个条件是：

    ACK为高即外设已从8255A取走数据；

    OBF为高即输出锁存器已空；

   INTE为高即8255允许以中断方式应答。

- INTE：中断允许信号。设置中断允许或屏蔽中断的信号。INTE没有外部引出端，由软件对C口某位进行置0或置1的操作实现。

  对A口来讲，由PC6的置位来实现，

  对B口仍然是由PC2的置位来实现。
  
  ##### 1方式下数据输出过程
  
  ![image-20220527020502573](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527020502.png)

#### 方式2：双向选通I/O方式。

1）方式2只适用于A口，指定A口既作收入口又作输出口，B口仍可按方式0或方式1工作。

2）A口工作在双向方式时，C口高5位即PC7～PC3位作为A口控制/状态信号端口，用来提供应答信号，PC2～PC0用于B组

3）A口的输入/输出均有锁存功能。在方式2工作状态下，A口既可工作于查询方式，又可工作于中断方式。

![image-20220526195411676](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526195411.png)

![image-20220526195459716](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526195459.png)

  方式2的时序实际上也是方式1的输入与输出的时序的组合。当一个外设既可以用作输入也可以用作输出时，将其接口初始化为方式2，这样输入/输出就不用再重新初始化了，具体某个时刻是输出操作还是输入操作由程序来控制，CPU可以通过中断或查询状态字来控制程序进程。

   方式2的输入与输出是一个  中断源，因此，在中断处理程序中还应该查询8255的状态字，进 一步识别是输入申请中断还是输出申请中断，来启动不同的处理程序。 



### 8255A的控制字

控制字分两类，一类是控制并行口的工作方式的命令，一类是专门对C口按位置0/置1的设置，控制字必须写入控制口才能有效。

![image-20220527020007476](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527020007.png)

图7.3中的最高位D,是特征位,82C55A有两个命令,用特征位加以区别:D,=1,表示是方式命令;D,=0,表示是C端口按位置位/复位命令.

  这两类控制字均写入控制端口地址，用命令的最高位D7位进行区分，所以控制字的最高位D7称为控制字标志位。

- D7=1时，方式控制字。

  设定A口、B口、C口的工作状态（输入/输出）和工作方式（方式0、方式1、方式2）。

- D7=0时，端口C置位/复位功能。

    使C口中的某一位为1 (置位)或0 (复位)。

#### 1）方式控制字 

​			![image-20220526195619943](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526195620.png)



# **第九章	 串行接口技术**

### 串行通信传输的工作方式

**1.**   全双工

全双工是通信双方同时进行发送和接收操作。为此，**要设置两根传输线**，分别发送和接收 数据，使数据的发送与接收分流，如图8.1所示。全双工方式在通信过程中，无须进行接收/发 送方向的切换，因此，没有切换操作所产生的时间延迟，有利于远程实时监测与控制。

**2.**    半双工

半双工是通信双方分时进行发送和接收操作，即双方都可发可收，但不能在同一时刻发送 和接收。**因为半双工只设置一根传输线**，用于发送时就不能接收，用于接收时就不能发送，如 图8. 2所示，所以在半双工通信过程中，需要进行接收/发送方向的切换，会有延时产生。

3. 单工

通信双方只能进行一个方向的传输，不能有双向传输。此方式目前很少使用了。

### 串行通信的基本方式

**1.**    异步通信方式(仍然需要时钟)

异步通信是指字符与字符之间的传输是异步的，而字符内部位与位之间的传输是同步的。 因为异步通信是以字符为单位传输的，每个字符经过格式化之后，作为独立的一帧数据，可以 随机地由发送端发出去，即发送端发出的每个字符在通信线上出现的时间是任意的，接收端预 先并不知道。这就是说，异步通信方式的“异步”主要体现在字符与字符之间传输没有严格的 定时要求。然而，一旦字符传输开始，收发双方则以预先约定的传输速率，在时钟脉冲的作用 下，传输这个字符中的每一位，即要求位与位之间有严格而精确的定时。**也就是说，异步通信 在传输同一个字符的每一位时都是同步的。**

**2.**    同步通信方式

同步通信不仅要求字符内部的位与位之间的传输是同步的,并且要求字符与字符之间的传输也是同步的。因为同步通信是以数据块（字符块）为单位传输的，每个数据块经过格式化 之后，形成一帧数据，作为一个整体进行发送与接收，因此，传输一旦开始，就要求每帧数据内 部的每一位都要同步。也就是说，同步传输不仅要求字符内部的位传输是同步的，而且要求字 符与字符之间的传输也应该是同步的，这样才能保证收发双方对每一位都是同步的。为此，接 收/发送两端必须使用同一时钟来控制数据块传输时字符与字符、字符内部位与位之间的 定时。

异步通信方式的传输速率低，同步通信方式的传输速率高。异步传输的传输设备简单，易于实现，同步传输的传输设备复杂，技术要求高。

**因此，异步串行通信一般用在数据传输时间 不能确定、发送数据不连续、数据量较少和数据传输速率较低的场合；而同步串行通信则用在 要求快速、连续传输大批量数据的场合。**

### 数据传输速率控制的实现方法

串行通信时，要求双方的传输速率严格一致，并在传输开始之前，要预先设定，否则，会发 生错误。因此，对传输速率要进行控制。

### 通信格式中各位的含意

![image-20220526195635838](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526195635.png)

- 起始位：一个逻辑”0”，表示传输的开始。
- 数据位：数据位可以是5—8位的一个字符。从最低位开始传送，靠时钟定位。
- 奇偶校验位：(可有可无)数据位加该位后，使“1”的位数为偶数(偶校验)或奇数(奇校验)。
- 停止位：是一个字符数据的结束标志，可以是1位、1.5位、2位的高电平。
- 空闲位：处于逻辑“1”状态，表示当前线路上没有数据传送。

> 例：传送一个字符“E”，7个数据位，奇校验，2个停止位。(传送两个后面不空闲)
>
> 解：E的ASCII码为：45H， 7个数据位，即01000101B 
>
> ![image-20220526200259058](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526200259.png)

### 数据传输的速率

- #### 波特率

  - 在串行通信中，数据的传输速率即在基波传输的情况下（不加调制，以其固有频率传送）是用**每秒传送的位数**（bit/s）即波特率来表示的。
  - 1波特=1位/秒
  - 常用的标准波特率有110、300、 1000、1200、2400、 4800、 9600和19200波特。

#### 波特率、发送/接收时钟、波特率因子三者的关系

- 发送/接收时钟频率=波特率因子×波特率
- 在实际应用中，可根据所要求的传输波特率及所选择的波特率因子来确定发送/接收时钟的频率。

> #### 例如:要求传输速率为1200波特，则
>
> 当选择Factor=1时，发/收时钟频率=1.2kHz
>
> 当选择Factor=16时，发/收时钟频率=19.2kHz
>
> 当选择Factor=64时，发/收时钟频率=76.8kHz

思考：传输距离与传输速率之间有什么的关系？

答：传输距离随着传输速率的增加而减小。

### 8251A方式命令

波特率没有32

![image-20220527022018636](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527022018.png)

### 状态字的作用

状态字的作用是向CPU提供何时才能开始接收或发送,以及接收的数据中有无错误的信息。如果是异步通信,并且是在不考虑MODEM,即不使用联络信号的情况下,在状态字的8位中,有--些位就无关紧要,而有些关键位是必须使用的,称为关键位。

![image-20220527022149326](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527022149.png)

#### 信号电平标准(电气特性)

  RS-232C标准采用负逻辑EIA电平，规定：

逻辑1(Mark)在驱动器输出端为-5 V~-15 V,在负载端要求小于一3 V,
逻辑0(Space)在驱动器输出端为十5 V~+15 V,在负载端要求大于+3 V。

  “1”的逻辑电平在-3V~-15v之间;

  “0”的逻辑电平在+3V~+15V之间。  

  由于EIA电平与TTL电平完全不同，必须进行相应的电平转换。

![image-20220526200830291](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220526200830.png)

- #### 异步方式下的格式

每个字符也可以用5、6、7或8位来表示，时钟频率为传输波特率的1、16或64倍，用1位作为奇/偶校验，1个启动位，并能根据编程为每个数据增加1个、1.5个或2个停止位。 

- #### 全双工的工作方式

其内部提供具有双缓冲器的发送器和接收器。

- #### 提供出错检测

具有奇偶、溢出和帧错误三种检测电路，用户可以通过输入状态寄存器的内容进行查询。

- #### 发送器：由发送缓冲器和发送控制电路两部分组成。 

  TxD：发送器数据输出信号。CPU送往8251A的并行数据，在8251A内部被转变为串行数据后，通过TXD送往外设。  

  TxRDY：发送器准备好信号，高电平有效，用来通知CPU，8251A已准备好发送一个字符。TxRDY可用来作为中断请求信号，也可作为查询方式的联络信号使用。

  TxE：发送器空信号，TxE为高电平时，表示8251A发送器中并行到串行转换器空，说明一个发送动作已完成。

  TxC：发送器时钟输入，用来控制发送数据的速度。同步方式下，它的频率等于数据传输的波特率，异步方式下，它的频率可以为数据传输波特率的1倍、16倍或者64倍。

- #### 发送器：由发送缓冲器和发送控制电路两部分组成。 

  采用异步方式，则由发送控制电路在其首尾加上起始位和停止位，然后从起始位开始，经移位寄存器从数据输出线TXD逐位串行输出。

  CPU->数据发送缓冲器->发送控制电路->(加入 起始、校验、停止位)->发送移位寄存器->数据输出线TXD输出

  采用同步方式，则在发送数据之前，发送器将自动送出1个或2个同步字符，然后才逐位串行输出数据。

   如果CPU与8251A之间采用中断方式交换信息，那么TxRDY可作为向CPU发出的中断请求信号。 

- #### 接收器：由接收缓冲器和接收控制电路两部分组成。

  RxD：串行数据接收线。用来接收外设送来的串行数据，数据进入8251A后被转变为并行方式。

  RxC：接收器时钟信号，用来控制接收字符的速度。在实际使用时，RxC和TxC往往连在一起，由同一个外部时钟来提供，CLK则由另一个频率较高的外部时钟来提供。

  RxRDY：接收数据准备好信号，高电平有效，表示当前8251A已经从外部设备或调制解调器接收到一个字符，等待CPU来取走。因此，在中断方式时，RxRDY可用来作为中断请求信号；在查询方式时，RxRDY可用来作为查询信号。

  SYNDET：同步检测/断点检测信号。

  接收移位寄存器从RXD引脚上接收串行数据转换成并行数据后存入接收缓冲器。  

  数据输入线RXD->接收移位寄存器->接收控制电路->(去掉起始、校验、停止位)->数据接收缓冲器->CPU

  异步方式：在RxD线上检测低电平，将检测到的低电平作为起始位，8251A开始进行采样，完成字符装配，并进行奇偶校验和去掉停止位，变成了并行数据后，送到数据输入寄存器，同时发出RxRDY信号送CPU，表示已经收到一个可用的数据。

  同步方式：首先搜索同步字符。8251A监测RxD线，每当RxD线上出现一个数据位时，接收下来并送入移位寄存器移位，与同步字符寄存器的内容进行比较，如果两者不相等，则接收下一位数据，并且重复上述比较过程。当两个寄存器的内容比较相等时，8251A的SYNDET升为高电平，表示同步字符已经找到，同步已经实现。

# 第9章A/D与D/A转换器接口

### 分辨率

分辨率是指ADC能够把模拟量转换成二进制数的位数。ADC的分辨率反映在它的输出数据线的宽度上,

### 转换时间

低速和中速ADC-般采用查询或中断方式，而高速ADC就应采用DMA方式。

### LED显示器的显示方式

LED显示器有静态显示和动态显示两种方式。

# 第10章 基本人机交互设备的接口

7段数码显示器是将多个LED管组成一定字形的显示器,有共阴极和共阳极两种结构,

# 作业

1. (简答题)在PC机中，外设经8259发出中断请求，中断类型号为18H，中断服务程序入口地址为2370H:0100H。请画出对应的中断向量表。（参考教材图5.2，标明存储地址，中断向量，中断类型号等）

   ![8d82632db2ffc8f2bdafca0154308eca.jpeg](https://cdn.jsdelivr.net/gh/stingo1218/pic/img/20220527025802.jpeg)

# 随堂练习

1. 8086/8088的中断是向量中断，其中断服务的入口地址是由  中断类型号指向的中断向量表中读出
2. CPU响应中断的时间是  一条指令程序结束
3. CPU响应INTR引脚上来的中断请求的条件之一是  IF=1
4. 下列哪个不是内部中断?  中断请求线INTR
5. 8086CPU对中断请求响应优先级最低的请求是   单步中断
6. (单选题) 在PC/XT机中键盘的中断类型码是09H，则键盘中断矢量存储在    24H~27H
7. (单选题) 8086 CPU响应外部中断NMI和INTR时，相同的必要条件是  当前指令执行结束
8. (单选题) 8086的中断向量表中存放的是   中断服务程序入口地址
9. (单选题) 中断系统可以实现中断嵌套，其最主要的原因是  具有中断优先级管理机制
10. (单选题) 在8086系统中，一个中断类型号为0DBH的中断服务子程序入口地址是8100H:1234H，这个地址在中断向量表中连续4个存储单元存放的内容依次为  34H, 12H, 00H, 81H
11. (单选题) 8086的以下各种中断中，需要硬件提供中断类型号的只有  INTR
12. (单选题) 中断断点保存时，不需要压入堆栈的是  标志寄存器
13. (单选题) 常用的CPU与接口进行数据交换的方式是  以上三种都是
14. (单选题) 当多片8259A级联使用时，对于从8259A，级联信号CAS2~CASO是  输出信号
15. (单选题) 关于82C59A，下列说法错误的是   单片连接时sp=1，多片级联时sp=1
16. (单选题) 在Intel 8255A中可以进行按位置位/复位的端口是  端口C
17. (单选题) 8255A能实现双向传送功能的工作方式为  方式2
18. (判断题) 8255A工作于方式0时，只适合无条件传送方式。  对
19. (判断题) 8255A工作于方式2时，C口的8条线均不能用于输入/输出。  错
20. (判断题) 8255A工作于方式0时，不能使用中断，而在方式1或方式2时，既可用中断，也可不用中断。  对
21. (判断题) 8255A的数据输入寄存器具有数据锁存功能。  对

